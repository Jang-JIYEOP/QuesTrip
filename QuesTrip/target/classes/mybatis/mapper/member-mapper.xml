<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MemberMapper">

<insert id="join">
	INSERT INTO MEMBER (
	    NO
	    , MEMBER_TITLE_NO
	    , NICK
	    , ICON_NO
	    , ID
	    , PWD
	    , EMAIL
	    , POINT
	    ) 
	VALUES (
	    SEQ_MEMBER_NO.NEXTVAL
	    , 1	
	    , #{nick}
	    , 1
	    , #{id}
	    , #{pwd}
	    , #{email}
	    , 500
	    )
</insert>
	
<select id="login" resultType="com.kh.questrip.member.vo.MemberVo">
	
	SELECT
	    M.NO,
	    M.MEMBER_TITLE_NO,
	    MT.TITLE AS MEMBER_TITLE,
	    M.ICON_NO,
	    M.ID,
	    M.PWD,
	    M.NICK,
	    M.EMAIL,
	    M.POINT,
	    M.ENROLL_DATE,
	    M.DEL_YN,
	    i.PHOTO
	FROM
	    MEMBER M
	JOIN
	    ICON i ON M.ICON_NO = i.NO
    LEFT JOIN MEMBER_TITLE MT ON M.MEMBER_TITLE_NO = MT.NO
    WHERE 
	    M.DEL_YN = 'N'
	<if test="no ==null || no == ''">
		AND M.ID = #{id}
	    AND M.PWD = #{pwd}
	</if>

	<if test="no !=null and no != ''">
		AND M.NO = #{no}
	</if>
</select>

<update id="edit">
	UPDATE MEMBER SET
		NICK = #{nick},
		PWD = #{pwd}
	WHERE NO = #{no}
</update>


<select id="dupCheck" resultType="Integer">
	SELECT
		COUNT(*) AS count
	FROM MEMBER
	WHERE 
	DEL_YN = 'N'
	<if test="id != null and id != ''">
		AND ID = #{id}
	</if>
	<if test="nick != null and nick != ''">
		AND NICK = #{nick}
	</if>
	
</select>

<select id="list" resultType="com.kh.questrip.member.vo.MemberVo">
	SELECT 
	    M.NO,
	    IT.TITLE AS ICON_NAME,
	    MT.NO AS TITLE_NO,
	    MT.TITLE AS TITLE_NAME,
	    M.ID,
	    M.PWD,
	    M.NICK,
	    M.EMAIL,
	    M.POINT,
	    M.ENROLL_DATE,
	    M.DEL_YN
	FROM MEMBER M
	JOIN ICON IT ON M.ICON_NO = IT.NO
	JOIN MEMBER_TITLE MT ON M.MEMBER_TITLE_NO = MT.NO
</select>
</mapper>