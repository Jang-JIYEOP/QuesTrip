<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CompleteMapper">


	<select id="listAll" resultType="integer">
		SELECT COUNT(*) 
		FROM COM_QUEST
		WHERE STATE = '1'
	</select>
	
	<select id="pageList" resultType="com.kh.questrip.complete.vo.CompleteVo">
	        SELECT
	        	cq.NO,
			    cq.MEMBER_NO,
			    m.NICK AS MEMBER_NAME,
			    cq.QUEST_NO,
			    q.TITLE AS QUEST_NAME,
			    cq.RATE,
			    cq.IMG_PATH,
			    cq.COM_TIME,
			    q.CONTENT
			FROM
			    COM_QUEST cq
			JOIN
			    MEMBER m ON cq.MEMBER_NO = m.NO
			JOIN
			    QUEST q ON cq.QUEST_NO = q.NO
			WHERE STATE = '1'
	    OFFSET #{pageNo} ROWS FETCH NEXT #{limit} ROWS ONLY
	</select>
	
	<update id="update">
		UPDATE COM_QUEST
		SET 
			STATE = #{state}
			, REJEC_REASON = #{rejecReason}
		WHERE NO = #{no}
	</update>
	
	<select id="myList" resultType="com.kh.questrip.complete.vo.CompleteVo">
	        SELECT
	        	cq.NO,
			    cq.MEMBER_NO,
			    m.NICK AS MEMBER_NAME,
			    cq.QUEST_NO,
			    q.TITLE AS QUEST_NAME,
			    cq.RATE,
			    cq.IMG_PATH,
			    cq.COM_TIME,
			    q.CONTENT
			FROM
			    COM_QUEST cq
			JOIN
			    MEMBER m ON cq.MEMBER_NO = m.NO
			JOIN
			    QUEST q ON cq.QUEST_NO = q.NO
			WHERE CQ.MEMBER_NO = #{memberNo}
	    OFFSET #{pageNo} ROWS FETCH NEXT #{limit} ROWS ONLY
	</select>
</mapper>

